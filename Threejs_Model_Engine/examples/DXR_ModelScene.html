<!DOCTYPE html>
<html lang="en">

<head>
	<title>three.js webgl - clipping planes</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		body {
			margin: 0;
			background-color: #000;
			color: #fff;
			font-family: Monospace;
			font-size: 13px;
			line-height: 24px;
			overscroll-behavior: none;
		}
		a {
			color: #ff0;
			text-decoration: none;
		}
		a:hover {
			text-decoration: underline;
		}
		button {
			cursor: pointer;
			text-transform: uppercase;
		}
		canvas {
			display: block;
		}
		#info {
			position: absolute;
			top: 0px;
			width: 100%;
			padding: 10px;
			box-sizing: border-box;
			text-align: center;
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
			user-select: none;
			pointer-events: none;
			z-index: 1;
			/* TODO Solve this in HTML */
		}
		a,
		button,
		input,
		select {
			pointer-events: auto;
		}
		.dg.ac {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
			user-select: none;
			z-index: 2 !important;
			/* TODO Solve this in HTML */
		}
		.btn-rightmenu {
			width: 220px;
			height: 40px;
			background: rgba(255, 255, 255, 0.88);
		}
		.btn-rightmenu:hover {
			background: rgba(245, 245, 245, 1);
		}
		.btn-mainmenu {
			width: 48px;
			height: 48px;
			position: relative;
			margin-right: auto;
			display: inline-block;
			margin-left: 16px;
			margin-top: 16px;
		}

		.btn-menuline{
			background-color: #1b1b1b;
			width: 2px;
			height: 48px;
			position: relative;
			margin-left: 16px;
			margin-right: auto;
			display: inline-block;

		}

		.btn-mainmenu:hover {
			background: rgba(245, 245, 245, 1);
			border-radius: 4px;
		}
		li {
			list-style: none;
			list-style-image: url(files/img/CheckBox_Normal.png);
			color: #1b1b1b;
		}
		ul {
			list-style: none;
			list-style-image: url(files/img/CheckBox_Normal.png);
			color: #1b1b1b;
		}

		.contaniner-fixcontainer{
			font-family:PingFangSC-Medium,PingFang SC;

			position: relative;
			margin: 20px auto;
		}

		.div-uiviewer-container{
			height:80px;
			background:rgba(255,255,255,0.88);
			box-shadow:0px 2px 4px 0px rgba(0,0,0,0.12);
			border-radius:4px;
			position: absolute;
			left: 0;
			right: 0;
			bottom: 0;
			top: 697px;
			margin: auto;

		}

		.label-viewtitle {
			width: 72px;
			height: 28px;
			font-size: 18px;
			font-weight: bold;
			color: rgba(60, 60, 60, 1);
			line-height: 28px;
			position: relative;
			left: 4%;
		}
		.cbox-treenodeNoexp {
			width: 300px;
			line-height: 30px;
			color: #1b1b1b;
			padding-left: 21px;
		}
		.cbox-treenodeexp {
			width: 98%;
			padding-top: 12px;
			line-height: 30px;
			color: #1b1b1b;
			padding-left: 11px;
		}
		.cbox-treearrow {
			position: relative;
			display: inline-block;
			vertical-align: middle;
		}
		.cbox-treebox {
			position: relative;
			display: inline-block;
			vertical-align: middle;
			padding-left: 2px;
		}
		.cbox-treelabel {
			position: relative;
			display: inline-block;
			padding-left: 5px;
			vertical-align: middle;
		}
		.div-menuview {
			position: absolute;
			top: 1%;
			right: 1%;
		}

		.div-featureview{
			background:rgba(255,255,255,0.88);
			box-shadow:0px 2px 4px 0px rgba(0,0,0,0.12);
			border-radius:4px;
		}


		#table_wrap{
			overflow: scroll;
			position: relative;
			margin: auto;
			width: 98%;
			height: 94%;
		}

		#table_wrap > table {

			font-size: 14px;
			font-weight:400;
			margin: 0 auto;
			text-align: left;
			border-radius:4px;
			border:1px solid rgba(232,233,235,1);
			border-collapse: separate;
			width: 96%;
			position: relative;

		}

		table tr:not(:last-of-type) td,th{
			border-bottom: 1px solid #eaeaea;
		}

		table tr td,th {
			height: 40px;
			color:rgba(60,60,60,1);
			line-height:24px;
		}

		table tr td:nth-child(1){
			color:rgba(128,128,128,1);

			width:30%;

		}
		table tr td:nth-child(2){
			color:rgba(60,60,60,1);
			width: 70%;
		}
		table tr th{
			background:rgba(245,245,245,1);
		}


		#updateview_container > div{
			width: 90%;
			line-height: 30px;
			color: #1b1b1b;
			padding-left: 21px;
		}

		.updateview-statusicon{
			width: 20px;
			height: 20px;
			position: relative;
			display: inline-block;
			vertical-align: middle;
		}


		.updateview-arrow{
			position: relative;
			display: inline-block;
			vertical-align: middle;
			padding-left: 2px;
			left: 80%;
		}
		#updateview_container > label{
			position: relative;
			display: inline-block;
			padding-left: 5px;
			vertical-align: middle;
		}

		.selected{border: 1px solid red ;color: red;}


	</style>
</head>

<body>
<div class="contaniner-fixcontainer" >
	<div id="mainviewer" style="background: linear-gradient(0deg, rgb(246, 250, 255) 10%, rgb(214, 224, 235) 70%);"></div>
	<div id="uiviewer" class="div-uiviewer-container" ></div>
	<div id="modelinfo" style="width: 300px;height: 201px;background: rgba(123,120,255,0.88);box-shadow:0px 2px 4px 0px rgba(0,0,0,0.12);border-radius:4px;position: absolute;top: 2%;left: 40%;">
		<button style="width: 96px;height:48px;position: absolute;top: 15%;left: 3%;" onclick="ElementHideAll()">隐藏所有构件</button>
		<button style="width: 96px;height:48px;position: absolute;top: 15%;left: 38%;" onclick="ElementShowAll()">显示所有构件</button>
		<button style="width: 96px;height:48px;position: absolute;top: 15%;left: 76%;" onclick="ElementTranslucentAll()">半透明所有构件</button>
		<button style="width: 96px;height:48px;position: absolute;top: 35%;left: 3%;" onclick="ElementRequeAll()">还原所有构件</button>
		<button style="width: 96px;height:48px;position: absolute;top: 35%;left: 38%;" onclick="ElementSelect(799057)">查找name为799057的构件</button>
	</div>
	<div id="menuview">
		<div id="floorview"  class="div-featureview" style="width:280px;height:544px;position: absolute;top: 10%;left: 10%;">
			<label class="label-viewtitle">楼层选择</label>
			<img class="div-menuview" src='files/img/btn_viewpoint_cancel_normal.png' onclick="FeatureOnClose(this.parentNode)">
			<div style="height: 516px; overflow:scroll">
				<div style="border: 1px  #000000; width: 90%; margin: 0 auto;">
					<div class="cbox-treenodeexp" id="floorlist" treetype="1" selected='0' IsShow='0'><img src='files/img/btn_tips_2.png' class="cbox-treearrow" onclick='FloorArrowOnClick(this.parentNode)'><img src='files/img/CheckBox_Normal.png' class="cbox-treebox" onclick='FloorBoxOnClick(this.parentNode)'><label class="cbox-treelabel">全部</label>
					</div>
				</div>
			</div>
		</div>
		<div id="domainview" class="div-featureview" style="width:280px;height:544px;position: absolute;top: 10%;left:25%;">
			<label class="label-viewtitle">专业选择</label>
			<img class="div-menuview" src='files/img/btn_viewpoint_cancel_normal.png' onclick="FeatureOnClose(this.parentNode)">
			<div style="height: 516px; overflow:scroll">
				<div style="border: 1px  #000000; width: 90%; margin: 0 auto;" id="domainlist">
				</div>
			</div>
		</div>

		<div id="elementinfo" class="div-featureview" style="width:390px;height:544px;position: absolute;top: 10%;left:70%;">
			<label class="label-viewtitle">构建详情</label>
			<img class="div-menuview" src='files/img/btn_viewpoint_cancel_normal.png' onclick="FeatureOnClose(this.parentNode)">
			<div  id="table_wrap"><table id="table_container"  class="table" cellspacing="0" cellpadding="0" ></table></div>
		</div>

		<div id="updateview" class="div-featureview" style="width:280px;height:544px;position: absolute;top: 10%;left:55%;">
			<label class="label-viewtitle">变更列表</label>
			<img class="div-menuview" src='files/img/btn_viewpoint_cancel_normal.png' onclick="FeatureOnClose(this.parentNode)">
			<div id="updateview_container" style="height: 516px; overflow:scroll"></div>
		</div>

	</div>
	<div id="myMenu" style="width:220px;height:355px;background:rgba(255,255,255,0.88);box-shadow:0px 4px 12px 0px rgba(0,0,0,0.04);border-radius:4px;border:1px solid rgba(232,233,235,1);display: block;position: absolute; top: 381px; left: 1250px;">
		<div class="btn-rightmenu">
			<label style="font-size:14px;font-weight:400;color:rgba(60,60,60,1);line-height: 40px;text-align: center;left: 6%;position: relative;" onclick="ElementInfo()" >构件详情</label>
		</div>
		<div class="btn-rightmenu">
			<label style="font-size:14px;font-weight:400;color:rgba(60,60,60,1);line-height: 40px;text-align: center;left: 6%;position: relative;">隐藏选中构件</label>
		</div>
		<div class="btn-rightmenu">
			<label style="font-size:14px;font-weight:400;color:rgba(60,60,60,1);line-height: 40px;text-align: center;left: 6%;position: relative;">半透明选中构件</label>
		</div>
		<div class="btn-rightmenu">
			<label style="font-size:14px;font-weight:400;color:rgba(60,60,60,1);line-height: 40px;text-align: center;left: 6%;position: relative;">孤立显示</label>
		</div>
		<div class="btn-rightmenu">
			<label style="font-size:14px;font-weight:400;color:rgba(60,60,60,1);line-height: 40px;text-align: center;left: 6%;position: relative;">显示所有</label>
		</div>
		<div class="btn-rightmenu">
			<label style="font-size:14px;font-weight:400;color:rgba(60,60,60,1);line-height: 40px;text-align: center;left: 6%;position: relative;">创建任务</label>
		</div>
		<div class="btn-rightmenu">
			<label style="font-size:14px;font-weight:400;color:rgba(60,60,60,1);line-height: 40px;text-align: center;left: 6%;position: relative;">相关文档</label>
		</div>
		<div class="btn-rightmenu">
			<label style="font-size:14px;font-weight:400;color:rgba(60,60,60,1);line-height: 40px;text-align: center;left: 6%;position: relative;">相关事项</label>
		</div>
	</div>
</div>

<script src="../build/three.js"></script>
<script src="./models/TzBase.js"></script>
<script src="./models/data.js"></script>
<script src="js/controls/MapControls.js"></script>
<script src="js/libs/stats.min.js"></script>
<script src="js/libs/dat.gui.min.js"></script>
<script src="js/UITool.js"></script>
<script src="js/libs/inflate.min.js"></script>
<script src="js/loaders/FBXLoader.js"></script>

<script src="js/WebGL.js"></script>
<script>
	var camera, scene, renderer, startTime, object, stats, raycaster = new THREE.Raycaster();

	var models = new Array();

	var viewCubeCamera;
	var viewsetting = {
		left: 0.5,
		bottom: 0,
		width: 0.5,
		height: 0.5,
		background: new THREE.Color(0.7, 0.5, 0.5),
		eye: [0, 1800, 0],
		up: [0, 0, 1],
		fov: 45,
		updateCamera: function (camera, scene, mouseX) {

			camera.position.x -= mouseX * 0.05;
			camera.position.x = Math.max(Math.min(camera.position.x, 2000), -2000);
			camera.lookAt(camera.position.clone().setY(0));
		}
	};

	var viewCube;
	var viewCubeGroup = new THREE.Group();
	var  viewPos=new THREE.Vector3(0,0,0);

	var domainhtml = "";


	var insetWidth;
	var insetHeight;

	//菜单
	var menucodes = [1, 2, 3, 4, 5, 6, 21, 22, 23, 41, 42];

	var menuwidth=16;

	//floor
	var floornodes = new Array();
	var floordefflag = true;

	var floormodels;

	var domainmodels;

	var curelements=new Array();

	//contorl
	var curselected = new THREE.Geometry();

	var mouseStatus=2;

	var datGui;


	//boxselection

	var selectionLinemat;
	var selectionLine;
	var selDiv;
	var evt;
	var isSelect;
	var startX;
	var startY;

	init();
	animate();

	async function getModel(groupId, domain, version, group) {

		let uri = `http://127.0.0.1:3001/module/getDataForThree2?moduleGroupId=${groupId}&domain=${domain}&version=${version}`;
		let res = await fetch(uri).then(res => res.json());
		for (let [
			[id, color, type, _, lod, grade, boundingBox], item2, item3, item4, ...transforms
		] of res) {
			// for (let [[id, color, type], [Length, Diameter, Points]] of data) {
			switch (type) {
					// case TzExtrudeGeometry.TYPE_PIPE: {
					//     return TzPipeGeometry.createInstance(lon, lat, id, item2, item3, item4, colorIdx);
					// }
					// case TzGeometry.TYPE_CYLINDER: {
					//     let [Length, Diameter, Points] = item2;
					//     let objs = TzCylinderGeometry.from(lon, lat, id, Points, Diameter, Length, color, {lod, grade});
					//     objs.forEach(obj => group.add(obj.mesh));
					//     break;
					// }
				case TZ.TzGeometry.TYPE_EXTRUDE:
				{
					let obj = TZ.TzExtrudeGeometry.createInstance(0, 0, id, item2, item3, item4, color, {
						lod, grade, boundingBox
					});
					group.add(obj.mesh);
					break;
				}
				case TZ.TzGeometry.TYPE_NORMAL:
				{
					let obj = TZ.TzIrregularGeometry.createInstance(0, 0, id, item2, item3, item4, color, {
						lod, grade, boundingBox
					});
					// group.add(obj.mesh);
					break;
				}
				case TZ.TzGeometry.TYPE_BUFFERED:
				{
					let objs = transforms
							.map(([instanceId, matrix]) => TZ.TzIrregularBufferedGeometry.createInstance(0, 0, id, instanceId, item2, item3, item4, matrix, color, {
								lod, grade, boundingBox
							}));
					objs.forEach(obj => group.add(obj.mesh));
					break;
				}
			}
		}


		return group;
	}


	function init() {

		insetWidth = window.innerHeight / 4; // square
		insetHeight = window.innerHeight / 4;

		//初始化主相机
		camera = new THREE.PerspectiveCamera(36, window.innerWidth / window.innerHeight, 0.1, 9999);
		camera.position.set(100, 100, 100);

		//初始化viewcube相机
		viewCubeCamera = new THREE.PerspectiveCamera(40, 1, 1, 1000);
		viewCubeCamera.position.set(0,0,100);
		viewCubeCamera.lookAt(new THREE.Vector3(0,0,0));
		viewCubeCamera.layers.mask=10;

		//初始化场景
		scene = new THREE.Scene();

		//init light0
		light = new THREE.DirectionalLight(0xFFFFFF, 1.0, 0);
		light.position.set(100, 100, 200);
		scene.add(light);

		//初始化测试按钮
		GUIInit();

		// ***** Clipping planes: *****


		// Geometry
		// object.add(testBufferedGeometry())

		// object.castShadow = true;
		// scene.add( object );

		let points = [
			[109.1, -4.6, 12.5],
			[56.15, -4.6, 12.5],
			[56.15, -4.6, 6.0],
			[64.51, -4.6, 6.0],
			[64.51, -4.6, 8.3],
			[65.31, -4.6, 8.3],
			[65.31, -4.6, 6.0],
			[106.49, -4.6, 6.0],
			[106.49, -4.6, 8.3],
			[107.69, -4.6, 8.3],
			[107.69, -4.6, 6.0],
			[109.1, -4.6, 6.0],
			[104.592, -4.6, 6.15],
			[104.592, -4.6, 8.45],
			[105.792, -4.6, 8.45],
			[105.792, -4.6, 6.15],
			[94.2, -4.6, 6.15],
			[94.2, -4.6, 8.45],
			[95.4, -4.6, 8.45],
			[95.4, -4.6, 6.15],
			[86.355, -4.6, 6.15],
			[86.355, -4.6, 8.45],
			[87.855, -4.6, 8.45],
			[87.855, -4.6, 6.15],
			[77.007, -4.6, 6.15],
			[77.007, -4.6, 8.45],
			[78.507, -4.6, 8.45],
			[78.507, -4.6, 6.15],
			[65.99, -4.6, 6.15],
			[65.99, -4.6, 8.45],
			[67.49, -4.6, 8.45],
			[67.49, -4.6, 6.15],
			[84.16, -4.6, 6.15],
			[84.16, -4.6, 8.45],
			[85.66, -4.6, 8.45],
			[85.66, -4.6, 6.15],
			[56.15, -4.3, 12.5],
			[61.6, -4.3, 12.5],
			[61.9, -4.3, 12.5],
			[63.9, -4.3, 12.5],
			[64.2, -4.3, 12.5],
			[65.5, -4.3, 12.5],
			[65.8, -4.3, 12.5],
			[78.7, -4.3, 12.5],
			[79.0, -4.3, 12.5],
			[85.85, -4.3, 12.5],
			[86.15, -4.3, 12.5],
			[93.7, -4.3, 12.5],
			[94.0, -4.3, 12.5],
			[106.0, -4.3, 12.5],
			[106.3, -4.3, 12.5],
			[109.1, -4.3, 12.5],
			[109.1, -4.3, 6.0],
			[107.69, -4.3, 6.0],
			[107.69, -4.3, 8.3],
			[106.49, -4.3, 8.3],
			[106.49, -4.3, 6.0],
			[106.3, -4.3, 6.0],
			[106.0, -4.3, 6.0],
			[94.0, -4.3, 6.0],
			[93.7, -4.3, 6.0],
			[65.31, -4.3, 6.0],
			[65.31, -4.3, 8.3],
			[64.51, -4.3, 8.3],
			[64.51, -4.3, 6.0],
			[64.2, -4.3, 6.0],
			[63.9, -4.3, 6.0],
			[56.15, -4.3, 6.0],
			[104.592, -4.3, 8.45],
			[104.592, -4.3, 6.15],
			[105.792, -4.3, 6.15],
			[105.792, -4.3, 8.45],
			[94.2, -4.3, 6.15],
			[95.4, -4.3, 6.15],
			[95.4, -4.3, 8.45],
			[94.2, -4.3, 8.45],
			[86.355, -4.3, 6.15],
			[87.855, -4.3, 6.15],
			[87.855, -4.3, 8.45],
			[86.355, -4.3, 8.45],
			[77.007, -4.3, 6.15],
			[78.507, -4.3, 6.15],
			[78.507, -4.3, 8.45],
			[77.007, -4.3, 8.45],
			[65.99, -4.3, 6.15],
			[67.49, -4.3, 6.15],
			[67.49, -4.3, 8.45],
			[65.99, -4.3, 8.45],
			[84.16, -4.3, 6.15],
			[85.66, -4.3, 6.15],
			[85.66, -4.3, 8.45],
			[84.16, -4.3, 8.45],
			[109.1, -4.3, 6.0],
			[109.1, -4.6, 6.0],
			[107.69, -4.6, 6.0],
			[107.69, -4.3, 6.0],
			[106.49, -4.3, 6.0],
			[106.49, -4.6, 6.0],
			[65.31, -4.6, 6.0],
			[65.31, -4.3, 6.0],
			[93.7, -4.3, 6.0],
			[94.0, -4.3, 6.0],
			[106.0, -4.3, 6.0],
			[106.3, -4.3, 6.0],
			[56.15, -4.6, 6.0],
			[56.15, -4.3, 6.0],
			[63.9, -4.3, 6.0],
			[64.2, -4.3, 6.0],
			[64.51, -4.3, 6.0],
			[64.51, -4.6, 6.0],
			[56.15, -4.6, 12.5],
			[109.1, -4.6, 12.5],
			[109.1, -4.3, 12.5],
			[106.3, -4.3, 12.5],
			[106.0, -4.3, 12.5],
			[94.0, -4.3, 12.5],
			[93.7, -4.3, 12.5],
			[86.15, -4.3, 12.5],
			[85.85, -4.3, 12.5],
			[79.0, -4.3, 12.5],
			[78.7, -4.3, 12.5],
			[65.8, -4.3, 12.5],
			[65.5, -4.3, 12.5],
			[64.2, -4.3, 12.5],
			[63.9, -4.3, 12.5],
			[61.9, -4.3, 12.5],
			[61.6, -4.3, 12.5],
			[56.15, -4.3, 12.5],
			[109.1, -4.6, 12.5],
			[109.1, -4.6, 6.0],
			[109.1, -4.3, 6.0],
			[109.1, -4.3, 12.5],
			[106.49, -4.3, 8.3],
			[106.49, -4.6, 8.3],
			[106.49, -4.6, 6.0],
			[106.49, -4.3, 6.0],
			[106.49, -4.6, 8.3],
			[106.49, -4.3, 8.3],
			[107.69, -4.3, 8.3],
			[107.69, -4.6, 8.3],
			[107.69, -4.6, 8.3],
			[107.69, -4.3, 8.3],
			[107.69, -4.3, 6.0],
			[107.69, -4.6, 6.0],
			[104.592, -4.6, 6.15],
			[104.592, -4.3, 6.15],
			[104.592, -4.3, 8.45],
			[104.592, -4.6, 8.45],
			[104.592, -4.6, 8.45],
			[104.592, -4.3, 8.45],
			[105.792, -4.3, 8.45],
			[105.792, -4.6, 8.45],
			[105.792, -4.3, 6.15],
			[105.792, -4.6, 6.15],
			[105.792, -4.6, 8.45],
			[105.792, -4.3, 8.45],
			[104.592, -4.3, 6.15],
			[104.592, -4.6, 6.15],
			[105.792, -4.6, 6.15],
			[105.792, -4.3, 6.15],
			[94.2, -4.6, 6.15],
			[95.4, -4.6, 6.15],
			[95.4, -4.3, 6.15],
			[94.2, -4.3, 6.15],
			[95.4, -4.6, 6.15],
			[95.4, -4.6, 8.45],
			[95.4, -4.3, 8.45],
			[95.4, -4.3, 6.15],
			[95.4, -4.6, 8.45],
			[94.2, -4.6, 8.45],
			[94.2, -4.3, 8.45],
			[95.4, -4.3, 8.45],
			[94.2, -4.6, 8.45],
			[94.2, -4.6, 6.15],
			[94.2, -4.3, 6.15],
			[94.2, -4.3, 8.45],
			[86.355, -4.6, 6.15],
			[87.855, -4.6, 6.15],
			[87.855, -4.3, 6.15],
			[86.355, -4.3, 6.15],
			[87.855, -4.6, 6.15],
			[87.855, -4.6, 8.45],
			[87.855, -4.3, 8.45],
			[87.855, -4.3, 6.15],
			[87.855, -4.6, 8.45],
			[86.355, -4.6, 8.45],
			[86.355, -4.3, 8.45],
			[87.855, -4.3, 8.45],
			[86.355, -4.6, 8.45],
			[86.355, -4.6, 6.15],
			[86.355, -4.3, 6.15],
			[86.355, -4.3, 8.45],
			[77.007, -4.6, 6.15],
			[78.507, -4.6, 6.15],
			[78.507, -4.3, 6.15],
			[77.007, -4.3, 6.15],
			[78.507, -4.6, 6.15],
			[78.507, -4.6, 8.45],
			[78.507, -4.3, 8.45],
			[78.507, -4.3, 6.15],
			[78.507, -4.6, 8.45],
			[77.007, -4.6, 8.45],
			[77.007, -4.3, 8.45],
			[78.507, -4.3, 8.45],
			[77.007, -4.6, 8.45],
			[77.007, -4.6, 6.15],
			[77.007, -4.3, 6.15],
			[77.007, -4.3, 8.45],
			[65.99, -4.6, 6.15],
			[67.49, -4.6, 6.15],
			[67.49, -4.3, 6.15],
			[65.99, -4.3, 6.15],
			[67.49, -4.6, 6.15],
			[67.49, -4.6, 8.45],
			[67.49, -4.3, 8.45],
			[67.49, -4.3, 6.15],
			[67.49, -4.6, 8.45],
			[65.99, -4.6, 8.45],
			[65.99, -4.3, 8.45],
			[67.49, -4.3, 8.45],
			[65.99, -4.6, 8.45],
			[65.99, -4.6, 6.15],
			[65.99, -4.3, 6.15],
			[65.99, -4.3, 8.45],
			[84.16, -4.6, 6.15],
			[85.66, -4.6, 6.15],
			[85.66, -4.3, 6.15],
			[84.16, -4.3, 6.15],
			[85.66, -4.6, 6.15],
			[85.66, -4.6, 8.45],
			[85.66, -4.3, 8.45],
			[85.66, -4.3, 6.15],
			[85.66, -4.6, 8.45],
			[84.16, -4.6, 8.45],
			[84.16, -4.3, 8.45],
			[85.66, -4.3, 8.45],
			[84.16, -4.6, 8.45],
			[84.16, -4.6, 6.15],
			[84.16, -4.3, 6.15],
			[84.16, -4.3, 8.45],
			[56.15, -4.6, 6.0],
			[56.15, -4.6, 12.5],
			[56.15, -4.3, 12.5],
			[56.15, -4.3, 6.0],
			[65.31, -4.6, 8.3],
			[65.31, -4.3, 8.3],
			[65.31, -4.3, 6.0],
			[65.31, -4.6, 6.0],
			[65.31, -4.3, 8.3],
			[65.31, -4.6, 8.3],
			[64.51, -4.6, 8.3],
			[64.51, -4.3, 8.3],
			[64.51, -4.3, 8.3],
			[64.51, -4.6, 8.3],
			[64.51, -4.6, 6.0],
			[64.51, -4.3, 6.0]
		];
		let facets = [4, 2, 3, 28, 6, 31, 28, 5, 6, 30, 31, 24, 31, 6, 24, 6, 32, 27, 27, 24, 6, 32, 6, 35, 6, 7, 35, 33, 27, 32, 4, 5, 29, 1, 29, 30, 29, 1, 4, 28, 29, 5, 4, 1, 2, 25, 26, 1, 30, 24, 25, 1, 33, 0, 33, 1, 26, 26, 27, 33, 1, 30, 25, 0, 33, 34, 35, 21, 34, 17, 23, 16, 19, 16, 7, 23, 20, 7, 16, 23, 7, 12, 7, 15, 7, 12, 19, 8, 15, 7, 13, 19, 12, 10, 11, 9, 20, 35, 7, 0, 22, 17, 0, 21, 22, 17, 18, 0, 22, 23, 17, 8, 9, 0, 13, 14, 0, 0, 14, 8, 13, 0, 18, 9, 11, 0, 13, 18, 19, 8, 14, 15, 21, 0, 34, 20, 21, 35, 54, 52, 53, 57, 55, 56, 58, 70, 57, 70, 58, 69, 57, 70, 55, 52, 54, 51, 73, 69, 59, 59, 69, 58, 72, 59, 60, 72, 73, 59, 78, 60, 77, 76, 77, 60, 75, 72, 60, 73, 68, 69, 60, 89, 76, 70, 71, 55, 71, 68, 49, 55, 71, 50, 54, 50, 51, 48, 68, 74, 49, 50, 71, 68, 48, 49, 74, 68, 73, 50, 54, 55, 47, 75, 78, 75, 60, 78, 46, 78, 79, 48, 75, 47, 46, 47, 78, 90, 45, 46, 90, 46, 79, 75, 48, 74, 79, 76, 89, 85, 86, 80, 61, 85, 80, 84, 85, 61, 88, 60, 81, 88, 81, 91, 81, 61, 80, 84, 62, 87, 89, 60, 88, 63, 65, 66, 63, 66, 67, 61, 62, 84, 63, 64, 65, 87, 62, 41, 67, 37, 63, 61, 81, 60, 41, 62, 63, 43, 82, 83, 91, 81, 82, 86, 83, 80, 42, 43, 83, 91, 44, 45, 44, 91, 82, 82, 43, 44, 91, 45, 90, 83, 86, 42, 87, 42, 86, 41, 42, 87, 40, 41, 63, 39, 40, 63, 39, 63, 38, 37, 38, 63, 67, 36, 37, 89, 90, 79, 93, 94, 92, 95, 92, 94, 98, 100, 97, 100, 98, 99, 97, 101, 102, 101, 97, 100, 96, 97, 103, 103, 97, 102, 109, 107, 108, 106, 109, 104, 109, 106, 107, 106, 104, 105, 111, 117, 118, 117, 111, 116, 115, 116, 111, 111, 114, 115, 110, 118, 119, 118, 110, 111, 120, 121, 110, 120, 110, 119, 110, 121, 122, 113, 114, 111, 111, 112, 113, 125, 110, 124, 110, 126, 127, 125, 126, 110, 124, 110, 123, 123, 110, 122, 129, 130, 131, 131, 128, 129, 133, 135, 132, 135, 133, 134, 136, 137, 138, 138, 139, 136, 140, 141, 142, 142, 143, 140, 144, 145, 146, 146, 147, 144, 151, 149, 150, 149, 151, 148, 154, 155, 152, 152, 153, 154, 158, 159, 156, 156, 157, 158, 160, 161, 163, 162, 163, 161, 164, 165, 166, 166, 167, 164, 168, 169, 171, 170, 171, 169, 172, 173, 174, 174, 175, 172, 176, 177, 179, 178, 179, 177, 180, 181, 182, 182, 183, 180, 184, 185, 187, 186, 187, 185, 188, 189, 190, 190, 191, 188, 192, 193, 194, 194, 195, 192, 196, 197, 198, 198, 199, 196, 200, 201, 203, 202, 203, 201, 204, 205, 206, 206, 207, 204, 208, 209, 210, 210, 211, 208, 212, 213, 214, 214, 215, 212, 216, 217, 219, 218, 219, 217, 220, 221, 222, 222, 223, 220, 224, 225, 227, 226, 227, 225, 228, 229, 230, 230, 231, 228, 232, 233, 235, 234, 235, 233, 236, 237, 238, 238, 239, 236, 243, 240, 241, 241, 242, 243, 246, 247, 244, 244, 245, 246, 248, 249, 250, 250, 251, 248, 252, 253, 254, 254, 255, 252];
		let uvs = [
			[53.1, 0.0],
			[0.15, 0.0],
			[0.15, -6.5],
			[8.51, -6.5],
			[8.51, -4.2],
			[9.31, -4.2],
			[9.31, -6.5],
			[50.49, -6.5],
			[50.49, -4.2],
			[51.69, -4.2],
			[51.69, -6.5],
			[53.1, -6.5],
			[48.592, -6.35],
			[48.592, -4.05],
			[49.792, -4.05],
			[49.792, -6.35],
			[38.2, -6.35],
			[38.2, -4.05],
			[39.4, -4.05],
			[39.4, -6.35],
			[30.355, -6.35],
			[30.355, -4.05],
			[31.855, -4.05],
			[31.855, -6.35],
			[21.007, -6.35],
			[21.007, -4.05],
			[22.507, -4.05],
			[22.507, -6.35],
			[9.99, -6.35],
			[9.99, -4.05],
			[11.49, -4.05],
			[11.49, -6.35],
			[28.16, -6.35],
			[28.16, -4.05],
			[29.66, -4.05],
			[29.66, -6.35],
			[-0.15, 0.0],
			[-5.6, 0.0],
			[-5.9, 0.0],
			[-7.9, 0.0],
			[-8.2, 0.0],
			[-9.5, 0.0],
			[-9.8, 0.0],
			[-22.7, 0.0],
			[-23.0, 0.0],
			[-29.85, 0.0],
			[-30.15, 0.0],
			[-37.7, 0.0],
			[-38.0, 0.0],
			[-50.0, 0.0],
			[-50.3, 0.0],
			[-53.1, 0.0],
			[-53.1, -6.5],
			[-51.69, -6.5],
			[-51.69, -4.2],
			[-50.49, -4.2],
			[-50.49, -6.5],
			[-50.3, -6.5],
			[-50.0, -6.5],
			[-38.0, -6.5],
			[-37.7, -6.5],
			[-9.31, -6.5],
			[-9.31, -4.2],
			[-8.51, -4.2],
			[-8.51, -6.5],
			[-8.2, -6.5],
			[-7.9, -6.5],
			[-0.15, -6.5],
			[-48.592, -4.05],
			[-48.592, -6.35],
			[-49.792, -6.35],
			[-49.792, -4.05],
			[-38.2, -6.35],
			[-39.4, -6.35],
			[-39.4, -4.05],
			[-38.2, -4.05],
			[-30.355, -6.35],
			[-31.855, -6.35],
			[-31.855, -4.05],
			[-30.355, -4.05],
			[-21.007, -6.35],
			[-22.507, -6.35],
			[-22.507, -4.05],
			[-21.007, -4.05],
			[-9.99, -6.35],
			[-11.49, -6.35],
			[-11.49, -4.05],
			[-9.99, -4.05],
			[-28.16, -6.35],
			[-29.66, -6.35],
			[-29.66, -4.05],
			[-28.16, -4.05],
			[53.1, -0.15],
			[53.1, 0.15],
			[51.69, 0.15],
			[51.69, -0.15],
			[50.49, -0.15],
			[50.49, 0.15],
			[9.31, 0.15],
			[9.31, -0.15],
			[37.7, -0.15],
			[38.0, -0.15],
			[50.0, -0.15],
			[50.3, -0.15],
			[0.15, 0.15],
			[0.15, -0.15],
			[7.9, -0.15],
			[8.2, -0.15],
			[8.51, -0.15],
			[8.51, 0.15],
			[0.15, -0.15],
			[53.1, -0.15],
			[53.1, 0.15],
			[50.3, 0.15],
			[50.0, 0.15],
			[38.0, 0.15],
			[37.7, 0.15],
			[30.15, 0.15],
			[29.85, 0.15],
			[23.0, 0.15],
			[22.7, 0.15],
			[9.8, 0.15],
			[9.5, 0.15],
			[8.2, 0.15],
			[7.9, 0.15],
			[5.9, 0.15],
			[5.6, 0.15],
			[0.15, 0.15],
			[-0.15, 0.0],
			[-0.15, -6.5],
			[0.15, -6.5],
			[0.15, 0.0],
			[0.15, -4.2],
			[-0.15, -4.2],
			[-0.15, -6.5],
			[0.15, -6.5],
			[50.49, 0.15],
			[50.49, -0.15],
			[51.69, -0.15],
			[51.69, 0.15],
			[0.15, -4.2],
			[-0.15, -4.2],
			[-0.15, -6.5],
			[0.15, -6.5],
			[-0.15, -6.35],
			[0.15, -6.35],
			[0.15, -4.05],
			[-0.15, -4.05],
			[48.592, 0.15],
			[48.592, -0.15],
			[49.792, -0.15],
			[49.792, 0.15],
			[-0.15, -6.35],
			[0.15, -6.35],
			[0.15, -4.05],
			[-0.15, -4.05],
			[48.592, 0.15],
			[48.592, -0.15],
			[49.792, -0.15],
			[49.792, 0.15],
			[38.2, -0.15],
			[39.4, -0.15],
			[39.4, 0.15],
			[38.2, 0.15],
			[0.15, -6.35],
			[0.15, -4.05],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[39.4, 0.15],
			[38.2, 0.15],
			[38.2, -0.15],
			[39.4, -0.15],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[0.15, -6.35],
			[0.15, -4.05],
			[30.355, -0.15],
			[31.855, -0.15],
			[31.855, 0.15],
			[30.355, 0.15],
			[0.15, -6.35],
			[0.15, -4.05],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[31.855, 0.15],
			[30.355, 0.15],
			[30.355, -0.15],
			[31.855, -0.15],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[0.15, -6.35],
			[0.15, -4.05],
			[21.007, -0.15],
			[22.507, -0.15],
			[22.507, 0.15],
			[21.007, 0.15],
			[0.15, -6.35],
			[0.15, -4.05],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[22.507, 0.15],
			[21.007, 0.15],
			[21.007, -0.15],
			[22.507, -0.15],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[0.15, -6.35],
			[0.15, -4.05],
			[9.99, -0.15],
			[11.49, -0.15],
			[11.49, 0.15],
			[9.99, 0.15],
			[0.15, -6.35],
			[0.15, -4.05],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[11.49, 0.15],
			[9.99, 0.15],
			[9.99, -0.15],
			[11.49, -0.15],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[0.15, -6.35],
			[0.15, -4.05],
			[28.16, -0.15],
			[29.66, -0.15],
			[29.66, 0.15],
			[28.16, 0.15],
			[0.15, -6.35],
			[0.15, -4.05],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[29.66, 0.15],
			[28.16, 0.15],
			[28.16, -0.15],
			[29.66, -0.15],
			[-0.15, -4.05],
			[-0.15, -6.35],
			[0.15, -6.35],
			[0.15, -4.05],
			[0.15, -6.5],
			[0.15, 0.0],
			[-0.15, 0.0],
			[-0.15, -6.5],
			[0.15, -4.2],
			[-0.15, -4.2],
			[-0.15, -6.5],
			[0.15, -6.5],
			[9.31, -0.15],
			[9.31, 0.15],
			[8.51, 0.15],
			[8.51, -0.15],
			[0.15, -4.2],
			[-0.15, -4.2],
			[-0.15, -6.5],
			[0.15, -6.5]
		];
		let nor = [
			[36.0, -0.0, -0.305, 0.0],
			[56.0, 0.0, 0.305, 0.0],
			[18.0, 0.0, 0.0, -0.305],
			[18.0, 0.0, 0.0, 0.305],
			[4.0, 0.305, -0.0, 0.0],
			[4.0, 0.305, -0.0, 0.0],
			[4.0, 0.0, 0.0, -0.305],
			[4.0, -0.305, 0.0, 0.0],
			[4.0, 0.305, -0.0, 0.0],
			[4.0, 0.0, 0.0, -0.305],
			[4.0, -0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, 0.305],
			[4.0, 0.0, 0.0, 0.305],
			[4.0, -0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, -0.305],
			[4.0, 0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, 0.305],
			[4.0, -0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, -0.305],
			[4.0, 0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, 0.305],
			[4.0, -0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, -0.305],
			[4.0, 0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, 0.305],
			[4.0, -0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, -0.305],
			[4.0, 0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, 0.305],
			[4.0, -0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, -0.305],
			[4.0, 0.305, 0.0, 0.0],
			[4.0, -0.305, 0.0, 0.0],
			[4.0, -0.305, 0.0, 0.0],
			[4.0, 0.0, 0.0, -0.305],
			[4.0, 0.305, -0.0, 0.0]
		];

		let objs = data2;
		var j = 0;
		for (let [
			[id, color], item2, item3, item4
		] of objs) {
			let obj = TZ.TzExtrudeGeometry.createInstance(0, 0, id, item2, item3, item4, color);

			//			var material = new THREE.MeshToonMaterial();
			//			console.log(obj.mesh);
			//			obj.mesh.material=material;

			scene.add(obj.mesh);
			models[j] = obj.mesh;
			j++;
		}


		function drawLine(s, e, c) {
			//经度：114.31 ， 纬度：30.52
			let geometry = new THREE.Geometry();

			geometry.vertices.push(s);
			geometry.vertices.push(e);

			// geometry.rotateY(-30 / 180 * Math.PI);
			// geometry.rotateZ(121 / 180 * Math.PI);
			let material = new THREE.LineBasicMaterial({
				linewidth: 100,
				color: c
			});
			return new THREE.Line(geometry, material);
		}

		scene.add(drawLine(new THREE.Vector3(0, 0, 0), new THREE.Vector3(100000, 0, 0), new THREE.Color(1, 0, 0)));
		scene.add(drawLine(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 100000, 0), new THREE.Color(0, 1, 0)));
		scene.add(drawLine(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, 100000), new THREE.Color(0, 0, 1)));

		// Stats

		stats = new Stats();
		document.body.appendChild(stats.dom);
		var mouse = new THREE.Vector2(), intersectBefuuid, intersectNow, intersectlowmaterial;


		//boxselection

		var geomentryselection=new THREE.Geometry();
		var p1 =new THREE.Vector3(0,-20,0);
		var p2 =new THREE.Vector3(-20,0,0);

		geomentryselection.vertices.push(p1,p2);

		selectionLine=new THREE.Line(geomentryselection,new THREE.LineBasicMaterial({color:0xff0000}));

		scene.add( selectionLine );


		LoadViewCube();

		function onDocumentMouseDown(event) {

			if(mouseStatus==1){

				//通过鼠标点击的位置计算出raycaster所需要的点的位置，以屏幕中心为原点，值的范围为-1到1.
				mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
				mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

				// 通过鼠标点的位置和当前相机的矩阵计算出raycaster
				raycaster.setFromCamera(mouse, camera);

				// 获取raycaster直线和所有模型相交的数组集合
				var intersects = raycaster.intersectObjects(scene.children);
				if (intersects.length > 0) {
					intersectBefuuid = intersects[0].object.uuid;
				} else {
					intersectBefuuid = "";
				}
			}else if(mouseStatus==2){

				isSelect = true;
				// 获取事件触发后的event对象，做了一个兼容性处理
				evt = window.event || arguments[0];
				// 存放鼠标点击初始位置
				startX = (evt.x || evt.clientX);
				startY = (evt.y || evt.clientY);
				// 创建一个框选元素
				selDiv = document.createElement("div");
				// 给框选元素添加CSS样式，使用决定定位
				selDiv.style.cssText = "position:absolute; width:0px; height:0px; font-size:0px; margin:0px; padding:0px; border:1px dashed #0099FF; z-index:1000; filter:alpha(opacity:60); opacity:0.6; display:none";
				// 添加ID
				selDiv.id = "selectDiv";
				// appendChild()向节点添加最后一个子节点
				document.body.appendChild(selDiv);
				// 根据起始位置，添加定位
				selDiv.style.left = startX + "px";
				selDiv.style.top = startY + "px";

				// 根据坐标给选框修改样式
				var _x = null;
				var _y = null;
				clearEventBubble(evt);

			}

		}


		function onDocumentMouseUp(event) {

			if(mouseStatus==1) {
				//通过鼠标点击的位置计算出raycaster所需要的点的位置，以屏幕中心为原点，值的范围为-1到1.
				mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
				mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

				// 通过鼠标点的位置和当前相机的矩阵计算出raycaster
				raycaster.setFromCamera(mouse, camera);

				// 获取raycaster直线和所有模型相交的数组集合
				var intersects = raycaster.intersectObjects(scene.children);


				if (intersects.length === 0 && intersectNow == null) {
					return;
				}

				if (intersects.length === 0 && intersectNow != null) {
					intersectNow.object.material.color.set(intersectColor);
					intersectNow.object.material.opacity = 1;
					intersectNow = null;
					intersectColor = null;
					return;
				}
				if (intersects.length > 0 && intersectNow != null) {
					intersectNow.object.material.color.set(intersectColor);
					intersectNow.object.material.opacity = 1;
					intersectNow = intersects[0];
					intersectColor = intersectNow.object.material.color.clone();
					intersectNow.object.material.color.set(0x0000ff);
					intersectNow.object.material.opacity = 0.6;

					curselected = intersects.object;

					console.log("选中" + intersectNow.object);

					console.log(intersects[0]);
					console.log(intersects[0].object.name);
					console.log(intersects[0].object.uuid);
					return;
				}
				if (intersects.length > 0 && intersectNow == null) {
					intersectNow = intersects[0];
					intersectColor = intersectNow.object.material.color.clone();
					intersectNow.object.material.color.set(0x0000ff);
					intersectNow.object.material.opacity = 0.6;
					console.log(intersects[0]);
					console.log(intersects[0].object.name);
					console.log(intersects[0].object.uuid);
				}
			}else if(mouseStatus==2){

				if (selDiv) {
					document.body.removeChild(selDiv);
				}

				selDiv = null, startX = null, startY = null, evt = null;

				//这里进行相机拉近的效果

			}
		}

		function onDocumentMouseMove(event){
			MinMapJudgeMouseMove(event);
			return;
			if(mouseStatus==2){
				evt = window.event || arguments[0];
				if (isSelect) {
					// if (selDiv.style.display == "none") {
					// 	selDiv.style.display = "";
					// }
					// 获取当前鼠标位置
					_x = (evt.x || evt.clientX);
					_y = (evt.y || evt.clientY);
					selDiv.style.left = Math.min(_x, startX) + 'px';
					selDiv.style.top = Math.min(_y, startY) + 'px';
					selDiv.style.width = Math.abs(_x - startX) + 'px';  //Math.abs()返回数的绝对值
					selDiv.style.height = Math.abs(_y - startY) + 'px';

					// *******************************************************************************
					// 获取参数
					var _l = selDiv.offsetLeft;
					var _t = selDiv.offsetTop;
					var _w = selDiv.offsetWidth;
					var _h = selDiv.offsetHeight;

				}
				clearEventBubble(evt);
			}


		}


		document.addEventListener('mousedown', onDocumentMouseDown, false);
		document.addEventListener('mousemove',onDocumentMouseMove,false);
		document.addEventListener('mouseup', onDocumentMouseUp, false);
		// Renderer

		renderer = new THREE.WebGLRenderer({
			//增加下面两个属性，可以抗锯齿
			antialias: true,
			alpha: true
		});
		renderer.shadowMap.enabled = true;
		renderer.setClearColor(0xFFFFFF, 1.0);
		renderer.setPixelRatio(window.devicePixelRatio);
		renderer.setSize(window.innerWidth, window.innerHeight);
		window.addEventListener('resize', onWindowResize, false);

		document.getElementById("mainviewer").appendChild(renderer.domElement);

		var controls = new THREE.MapControls(camera, renderer.domElement);
		controls.target.set(0, 1, 0);
		controls.update();

		//增加右键菜单逻辑
		var myMenu = document.getElementById("myMenu");
		document.addEventListener("contextmenu", function (event) {
			event.preventDefault();
			myMenu.style.display = "block";
			//获取鼠标视口位置
			myMenu.style.top = event.clientY + "px";
			myMenu.style.left = event.clientX + "px";
		});
		document.addEventListener("click", function (event) {
			myMenu.style.display = "none";
		});


		//Menu信息初始化
		MenuViewInit();

		//Menu 菜单初始化
	}

	function GUIInit() {
		datGui = new dat.GUI();

		var params = {
			打开关闭小地图: false,
			// num:5,
			// color: new THREE.Color( 255, 0, 127 ),
			// sheen: new THREE.Color( 10, 10, 10 ), // corresponds to .04 reflectance
		};

		function onUpdate(valuess){
			console.log(valuess);
			minmapOperation(valuess);
		}
		datGui.add( params, '打开关闭小地图' ).onChange( onUpdate );
		datGui.open();

		}

	var MinMapContainer;
	//声明纹理
	var  sprite, texture;
	//声明小地图相机
	var cameraMinMap,controlsOrtho;
	//声明副场景，正交相机,
	var cameraUIOrtho, sceneOrtho;
	//判断鼠标是否在小地图中
	var mousePosInMimMap=false;
	var dpr = window.devicePixelRatio;
	var textureSize = 256 * dpr;
	var vector = new THREE.Vector2();

    var isHadOpenMinMap=false;

	function minmapOperation(isOpen) {
		if (isOpen) {
			initminmaap();
		}else{

		}
		isHadOpenMinMap=isOpen;
	}

	function initminmaap(){
		MinMapContainer = document.createElement( 'div' );
		MinMapContainer.setAttribute('id',"overlay");
		document.body.appendChild( MinMapContainer );
		var minpicture = document.createElement("div");
		minpicture.setAttribute('id',"minmap");
		MinMapContainer.appendChild(minpicture);

		var width = window.innerWidth;
		var height = window.innerHeight;

		//scene
		sceneOrtho = new THREE.Scene(minmap);

		//UIcamera
		cameraUIOrtho = new THREE.OrthographicCamera( - width / 2, width / 2, height / 2, - height / 2,1, 10);
		cameraUIOrtho.position.z = 10;
		sceneOrtho.add(cameraUIOrtho);

		//正交camera
		cameraMinMap = new THREE.OrthographicCamera( - width / 2, width / 2, height / 2, - height / 2,-1000, 1000);
		cameraMinMap.up = new THREE.Vector3(0,0,-1);
		cameraMinMap.lookAt( new THREE.Vector3(0,-1,0) );
		//cameraMinMap.lookAt(new THREE.Vector3(0,0,0));
		scene.add(cameraMinMap);

		//controlsOrtho
		controlsOrtho=new  THREE.MapControls( cameraMinMap);
		controlsOrtho.enabled=false;
		controlsOrtho.target.set( 0, 0, 0 );
		controlsOrtho.update();
		/* 属性参数 */
		controlsOrtho.enableDamping = true;// 启用动态阻尼时需要一个动画循环
		controlsOrtho.dampingFactor = 0.30;

		controlsOrtho.minZoom=0;
		controlsOrtho.maxZoom=500;//Infinity;
		controlsOrtho.zoomSpeed = 0.1;

		controlsOrtho.screenSpacePanning = true;// 若为 true 则可以平移

		controlsOrtho.enablePan = true;
		controlsOrtho.panSpeed = 0.1;

		controlsOrtho.maxDistance = 500;
		controlsOrtho.minDistance =0;

		controlsOrtho.enableRotate = false;

		//texture
		var data = new Uint8Array( textureSize * textureSize * 3 );
		texture = new THREE.DataTexture( data, textureSize, textureSize, THREE.RGBFormat );
		texture.minFilter = THREE.NearestFilter;
		texture.magFilter = THREE.NearestFilter;
		texture.needsUpdate = true;

		//sprite
		var spriteMaterial = new THREE.SpriteMaterial( { map: texture } );
		sprite = new THREE.Sprite( spriteMaterial );
		sprite.scale.set( textureSize, textureSize, 1 );
		sceneOrtho.add( sprite );
		var width = window.innerWidth;
		var height = window.innerHeight;
		updateSpritePosition();
		// var mapF = document.getElementById('minmap');
		// mapF.style.cssText = "right:0px ;bottom:0px; border:6px solid white";

	}

	function updateSpritePosition() {

		var halfWidth = window.innerWidth / 2;
		var halfHeight = window.innerHeight / 2;

		var halfImageWidth = textureSize / 2;
		var halfImageHeight = textureSize / 2;

		sprite.position.set( -(- halfWidth + halfImageWidth), -(halfHeight - halfImageHeight), 1 );
	}

	function MinMapUpdate(){
		var width = window.innerWidth;
		var height = window.innerHeight;
		cameraUIOrtho.left = - width / 2;
		cameraUIOrtho.right = width / 2;
		cameraUIOrtho.top = height / 2;
		cameraUIOrtho.bottom = - height / 2;
		cameraUIOrtho.updateProjectionMatrix();
		updateSpritePosition();
	}

	function MinMapJudgeMouseMove(event){
		//console.log(halfImageWidth+":"+halfImageHeight+"   "+halfWidth+":"+halfHeight);
		if( (event.clientX>(window.innerWidth-textureSize)) && (event.clientY>(window.innerHeight-textureSize))) {

			if (!mousePosInMimMap) {
				mousePosInMimMap=true;
				if(	controlsOrtho){
					controlsOrtho.enabled=true;
					controls.enabled=false;
				}
			}
			console.log(controlsOrtho.enabled+":X   "+controls.enabled);
		}else{
//	当鼠标在小地图上时，controls 处于false,否则为true
			if (mousePosInMimMap) {
				mousePosInMimMap=false;
				if (controls) {
					controls.enabled=true;
					controlsOrtho.enabled=false;
				}
			}
		}
	}










	function Selection(){}


	function onWindowResize() {
		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();
		renderer.setSize(window.innerWidth, window.innerHeight);

		insetWidth = window.innerHeight / 4; // square
		insetHeight = window.innerHeight / 4;


		viewCubeCamera.aspect = insetWidth / insetHeight;
		viewCubeCamera.updateProjectionMatrix();
			if(isHadOpenMinMap&&cameraUIOrtho){

				MinMapUpdate();
			}

	}

	function animate() {
		requestAnimationFrame(animate);
		stats.update();
		//stats.begin();
		//renderer.render(scene, camera);

		renderer.setClearColor(0x000000, 0);

		renderer.setViewport(0, 0, window.innerWidth, window.innerHeight);


		if(isHadOpenMinMap&&cameraMinMap&&texture&&cameraUIOrtho&&sceneOrtho){

			renderer.render( scene, cameraMinMap );
			vector.x = ( window.innerWidth * dpr / 2 ) - ( textureSize / 2 );
			vector.y = ( window.innerHeight * dpr / 2 ) - ( textureSize / 2 );
			renderer.copyFramebufferToTexture( vector, texture );
			renderer.clearDepth();
			renderer.render( scene, camera );
			renderer.render( sceneOrtho, cameraUIOrtho );

		}else{
			renderer.render(scene, camera);
		}

		//renderer.render(scene, camera);

		renderer.setClearColor( 0x222222, 0);

		renderer.clearDepth(); // important!

		renderer.setScissorTest(true);

		renderer.setScissor(window.innerWidth-insetWidth, window.innerHeight-insetHeight, insetWidth, insetHeight);

		renderer.setViewport(window.innerWidth-insetWidth, window.innerHeight-insetHeight, insetWidth, insetHeight);

		if(viewCubeCamera!=null){
			var newpos=camera.position.clone().normalize();
			newpos.x=newpos.x*100;
			newpos.y=newpos.y*100;
			newpos.z=newpos.z*100;

			viewCubeCamera.position.copy(newpos);
			viewCubeCamera.lookAt(new THREE.Vector3(0,0,0));
		}

		renderer.render(scene, viewCubeCamera);
		renderer.setScissorTest(false);


	}










	//测试功能
	//隐藏所有模型
	function ElementHideAll() {
		scene.traverse(function (obj) {
			if (obj.type === "Mesh") {
				obj.visible = false
			}
		})
	}

	//加载viewcube

	function LoadViewCube() {

		var loader = new THREE.FBXLoader();
		loader.load('files/model/viewcube/box1.FBX', function (object) {

			mixer = new THREE.AnimationMixer(object);

			object.traverse(function (child) {
				if (child.isMesh) {

					child.material.emissive=new THREE.Color(1,1,1);
					child.material.emissiveIntensity=1;
					child.material.emissiveMap=child.material.map;
					child.castShadow = true;
					child.receiveShadow = true;
					child.layers.mask=10;
				}
			});

			object.scale.x = 0.15;
			object.scale.y = 0.15;
			object.scale.z = 0.15;

			scene.add(object);
			object.position.set( 0, 0, 0);
			viewCube=object;
		});

	}

	//显示所有模型
	function ElementShowAll() {

		scene.traverse(function (obj) {
			if (obj.type === "Mesh") {
				obj.visible = true
			}
		})
	}

	//半透明所有模型
	function ElementTranslucentAll() {
		scene.traverse(function (obj) {
			if (obj.type === "Mesh") {
				obj.material.transparent = true;
				obj.material.opacity = 0.1;
			}
		})
	}

	//还原所有半透明模型
	function ElementRequeAll() {
		scene.traverse(function (obj) {
			if (obj.type === "Mesh") {
				if (obj.material.transparent == true) {
					obj.material.transparent = false;
					obj.material.opacity = 1;
				}
			}
		})
	}

	function ElementSelect(elementname) {
		curelements.length=0;
		scene.traverse(function (obj){
			if(obj.type=="Mesh"){
				if(obj.name==elementname){
					curelements.push(obj);
				}
			}
		});
	}


	//-----------------------------UI操作

	function clearEventBubble(evt) {
		// stopPropagation()不再派发事件。终止事件在传播过程的捕获、目标处理或起跑阶段进一步传播
		if (evt.stopPropagation)
			evt.stopPropagation();
		else
			evt.cancelBubble = true;  // 阻止该事件的进一步冒泡
		if (evt.preventDefault)
			evt.preventDefault();   // 取消事件的默认动作
		else
			evt.returnValue = false;
	}


	function MenuViewInit() {
		for (var i = 0; i < menucodes.length; i++) {
			InitUIFeature(menucodes[i]);
		}
	}

	function InitUIFeature(code) {

		var mainmenu = document.getElementById("uiviewer");

		mainmenu.setAttribute("style", "width:"+menuwidth+"px");

		switch (code) {
			case 1: //楼层列表
				console.log("生成楼层列表");
				var button = "<div class='btn-mainmenu'   onclick='Floormenu()' >" +
						"<img src=\'files/img/btn_Floor_Normal.png\' >" +
						"</div>";
				mainmenu.innerHTML += button;

				var floorlist = document.getElementById("floorlist");
				UITool.RequestGet("http://101.231.133.194:3001/module/getLevels?ModuleGroupId=81", function (json) {
					floormodels = JSON.parse(json);
					var list = "";
					if (floormodels.length > 0) {
						for (var i = 0; i < floormodels.length; i++) {
							list += "<div class='cbox-treenodeNoexp'  id='" + floormodels[i].LevelId + "' treetype='0'  selected='0' >";
							list += "<img  src='files/img/CheckBox_Normal.png'  class=\"cbox-treebox\" onclick='FloorBoxOnClick(this.parentNode)' >";
							list += "<label class=\"cbox-treelabel\" >" + floormodels[i].LevelName;
							list += "</label> </div>";
						}
					} else {}
					floorlist.innerHTML += list;
				});

				break;
			case 2: //专业列表
				console.log("生成专业列表");
				var button = "<div class='btn-mainmenu'  >" +
						"<img src=\'files/img/btn_Domain_Normal.png\' >" +
						"</div>";
				mainmenu.innerHTML += button;

				var domainlist = document.getElementById("domainlist");
				var json="{\"ModuleGroupId\":81,\"DomainInfos\":[{\"ModuleGroupId\":81,\"DomainName\":\"结构\",\"Version\":2}]}";

				UITool.RequestPost("http://101.231.133.194:3001/module/getDomainTree",'{"ModuleGroupId":81,"DomainInfos":[{"ModuleGroupId":81,"DomainName":"结构","Version":2}]}', function (json) {
					domainmodels = JSON.parse(json);
					var value= {content:""};

					if (domainmodels.length > 0) {
						for (var i = 0; i < domainmodels.length; i++) {
							UITool.DomainTreeInit(domainmodels[i],value);
						}
					} else {

					}
					domainlist.innerHTML += value.content;
				});

				break;
			case 3: //剖面框
				console.log("生成剖面框");
				var button = "<div class='btn-mainmenu'  >" +
						"<img src='files/img/btn_VertSlice_Normal.png' >" +
						"</div>";
				mainmenu.innerHTML += button;

				break;
			case 4: //框选放大
				console.log("生成框选放大");
				var button = "<div class='btn-mainmenu'  >" +
						"<img src='files/img/btn_Zoom_Normal.png' >" +
						"</div>";
				mainmenu.innerHTML += button;

				break;
			case 5: //漫游
				console.log("生成漫游");
				var button = "<div class='btn-mainmenu'  >" +
						"<img src='files/img/btn_Roaming_Normal.png' >" +
						"</div>";
				mainmenu.innerHTML += button;

				break;
			case 6: //小地图
				console.log("生成小地图");
				var button = "<div class='btn-mainmenu'  >" +
						"<img src='files/img/btn_MiniMap_Normal.png' >" +
						"</div>";
				mainmenu.innerHTML += button;

				break;
			case 7: //测量
				console.log("生成测量");
				var button = "<div class='btn-mainmenu'  >" +
						"<img src='files/img/btn_Measuring_Normal.png' >" +
						"</div>";
				mainmenu.innerHTML += button;

				break;
			case 21: //2/3维联动
				console.log("生成2/3维联动");
				var button = " <div class='btn-menuline' > </div><div class='btn-mainmenu' >" +
						"<img src='files/img/btn_2d_Normal.png' >" +
						"</div>";
				mainmenu.innerHTML += button;
				menuwidth+=16;
				break;
			case 22: //批注
				console.log("生成批注");
				var button = "<div class='btn-mainmenu'  >" +
						"<img src='files/img/btn_Note_Normal.png' >" +
						"</div>";
				mainmenu.innerHTML += button;
				break;
			case 41: //场景信息
				console.log("生成场景信息");
				var button = "<div class='btn-menuline' > </div><div class='btn-mainmenu'  >" +
						"<img src='files/img/btn_Rebar_Normal.png' >" +
						"</div>";
				mainmenu.innerHTML += button;
				menuwidth+=16;
				break;
			case 42: //场景设置
				console.log("生成场景设置");
				var button = "<div class='btn-mainmenu'  >" +
						"<img src='files/img/btn_Set_Normal.png' >" +
						"</div>";
				mainmenu.innerHTML += button;
				break;
			case 23: //
				console.log("生成版本对比");
				var button = "<div class='btn-mainmenu'  >" +
						"<img src='files/img/btn_Update_Normal.png' >" +
						"</div>";

				var updateviewcon=document.getElementById("updateview_container");

				var req='{"ModuleGroupId":81,"DomainName":"结构","BeforeVersion":2,"AfterVersion":8}';

				UITool.RequestPost("http://101.231.133.194:3001/module/diff",req, function (json) {
					console.log(JSON.parse(json));
					var data= JSON.parse(json);

					var value= {content:""};
					for (var i=0;i<data.length;i++){
						if(data[i].ChangeType==0){

							value.content+="<div><div class='updateview-statusicon' style='width:20px;height: 20px;background:green;border-radius: 10px'></div>"+
									"<img class='updateview-arrow' src='files/img/btn_tips_2.png'>"+
									"<label class=\"cbox-treelabel\">新增</label>";

							if(data[i].DomainTree.length>0){

								for (var j=0;j<data[i].DomainTree.length;j++){
									UITool.UpdateTreeInit(data[i].DomainTree[j],value);
								}
							}
							value.content+="</div>"

						}else if(data[i].ChangeType==1){

							value.content+="<div><div class='updateview-statusicon' style='width:20px;height: 20px;background:red;border-radius: 10px'></div>"+
									"<img class='updateview-arrow' src='files/img/btn_tips_2.png'>"+
									"<label class=\"cbox-treelabel\">删除</label>";


							if(data[i].DomainTree.length>0){
								for (var j=0;j<data[i].DomainTree.length;j++){
									UITool.UpdateTreeInit(data[i].DomainTree[j],value);
								}
							}
							value.content+="</div>"

						} else if(data[i].ChangeType==2){
							value.content+="<div><div class='updateview-statusicon' style='width:20px;height: 20px;background:yellow;border-radius: 10px'></div> "+
									"<img class='updateview-arrow' src='files/img/btn_tips_2.png'>"+
									"<label class=\"cbox-treelabel\">更新</label>";

							if(data[i].DomainTree.length>0){
								for (var j=0;j<data[i].DomainTree.length;j++){
									UITool.UpdateTreeInit(data[i].DomainTree[j],value);
								}
							}
							value.content+="</div>"

						}
					}

					updateviewcon.innerHTML+=value.content;

				});

				mainmenu.innerHTML += button;
				break;
		}

		menuwidth+=64;
		mainmenu.setAttribute("style", "width:"+menuwidth+"px");
	}

	//关闭视图
	function FeatureOnClose(node) {
		console.log("关闭视口")
	}

	var curfloorstatus = 'none';
	//打开楼层列表
	function Floormenu() {
		console.log("打开楼层列表");
		if (curfloorstatus == 'none') {
			curfloorstatus = 'inline';
		} else {
			curfloorstatus = 'none';
		}
		var mainmenu = document.getElementById("floorview");
		mainmenu.style.display = curfloorstatus;
	}

	function FloorArrowOnClick(data) {

		floordefflag = !floordefflag;
		//先取出字列表数据
		var chils = data.childNodes;

		if (chils.length > 0) {
			for (var i = 0; i < chils.length; i++) {
				if (chils[i].tagName == "DIV") {
					if (floordefflag) {
						chils[i].setAttribute("style", "display:block");
					} else {
						chils[i].setAttribute("style", "display:none");
					}
				}
			}

		} else {

		}
	}

	function DomainArrowOnClick(data) {

		console.log(data);
		//floordefflag = !floordefflag;
		//先取出字列表数据
		var chils = data.childNodes;

		var nodeflag=data.getAttribute("show");
		if (chils.length > 0) {
			for (var i = 0; i < chils.length; i++) {
				console.log(chils[i]);
				if (chils[i].tagName == "DIV") {
					if (nodeflag==0) {
						chils[i].setAttribute("style", "display:block");
					} else if(nodeflag==1) {
						chils[i].setAttribute("style", "display:none");
					}
				}
			}

			if(nodeflag==0){
				nodeflag=1;
			}else if(nodeflag==1){
				nodeflag=0;
			}

			data.setAttribute("show",nodeflag);

		}else{

		}
	}
	function DomainBoxOnClick(data) {
		UITool.TreeChangeOnClick(data);
	}

	function FloorBoxOnClick(data) {
		UITool.TreeChangeOnClick(data);
	}

	//----------------------------模型操作
	function ElementInfo() {
		console.log("模型信息");
		UITool.RequestGet("http://101.231.133.194:3001/module/getProperty?ModuleGroupId=81&ElementId=2_51_229&Version=2", function (json) {
			var elementinfo=JSON.parse(json);
			var tablehtml = document.getElementById("table_container");

			var childs = tablehtml.childNodes;
			for(var i = childs.length - 1; i >= 0; i--) {
				tablehtml.removeChild(childs[i]);
			}

			var dic=new Array();

			for (i=0;i<elementinfo.Parameters.length;i++){
				if(!dic[elementinfo.Parameters[i].Label]){
					dic[elementinfo.Parameters[i].Label]=new Array();
				}
				dic[elementinfo.Parameters[i].Label].push({str1:elementinfo.Parameters[i].Name,str2:elementinfo.Parameters[i].Value+" "+elementinfo.Parameters[i].ValueType});
			}

			var value="<tr><td>类型</td><td>"+elementinfo.Category.Name+"</td></tr><tr><td>名称</td></td><td>"+elementinfo.FamilyType.Name+"</td></tr><tr><td>专业</td><td>土建</td></tr>";
			for(var key in dic){

				var item=dic[key];
				value+="<tr><th>"+key+"</th><th></th></tr>";

				for (var i=0;i<item.length;i++){
					value+="<tr><td>"+item[i].str1+"</td><td>"+item[i].str2+"</td></tr>";
				}
			}
			tablehtml.innerHTML += value;
		});

	}

	function ModelEnable() {

	}
</script>

</body>

</html>
